{
  "version": 3,
  "sources": ["../../@arcgis/core/views/layers/ImageryTileLayerView.js", "../../@arcgis/core/views/3d/layers/ImageryTileLayerView3D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../Graphic.js\";import r from\"../../core/Error.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import{getDefaultDatumTransformationForDataset as a,projectExtent as n}from\"../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import{getFetchPopupTemplate as l}from\"./support/popupUtils.js\";const p=p=>{let u=class extends p{constructor(){super(...arguments),this._rasterFieldPrefix=\"Raster.\",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&\"dynamicRangeAdjustment\"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return a(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(e){return!!this.projectFullExtent(e)}projectFullExtent(e){const t=this.layer.fullExtent,r=a(t,e,!1);return n(t,e,r)}async fetchPopupFeatures(e,o){const{layer:s}=this;if(!e)throw new r(\"imageryTileLayerView:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s});const{popupEnabled:i}=s,a=l(s,o);if(!i||null==a)throw new r(\"imageryTileLayerView:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:i,popupTemplate:a});const n=[],{value:p,magdirValue:u,processedValue:c}=await s.identify(e,{timeExtent:this.timeExtent});let f=\"\";if(p&&p.length){f=\"imagery-tile\"===s.type&&s.hasStandardTime()&&null!=p[0]?p.map((e=>s.getStandardTimeValue(e))).join(\", \"):p.join(\", \");const e={ObjectId:0},r=\"Raster.ServicePixelValue\";e[r]=c?.join(\", \")??f,e[r+\".Raw\"]=f;const o=s.rasterInfo.attributeTable;if(null!=o){const{fields:t,features:r}=o,s=t.find((({name:e})=>\"value\"===e.toLowerCase())),i=s?r.find((e=>String(e.attributes[s.name])===f)):null;if(i)for(const o in i.attributes)if(i.attributes.hasOwnProperty(o)){e[this._rasterFieldPrefix+o]=i.attributes[o]}}const i=s.rasterInfo.dataType;\"vector-magdir\"!==i&&\"vector-uv\"!==i||(e[\"Raster.Magnitude\"]=u?.[0],e[\"Raster.Direction\"]=u?.[1]);const a=new t(this.fullExtent.clone(),null,e);a.layer=s,a.sourceLayer=a.layer,n.push(a)}return n}};return e([o()],u.prototype,\"layer\",void 0),e([o(i)],u.prototype,\"timeExtent\",void 0),e([o()],u.prototype,\"view\",void 0),e([o()],u.prototype,\"fullExtent\",null),e([o()],u.prototype,\"tileInfo\",void 0),e([o({readOnly:!0})],u.prototype,\"hasTilingEffects\",null),e([o()],u.prototype,\"datumTransformation\",null),u=e([s(\"esri.views.layers.ImageryTileLayerView\")],u),u};export{p as default};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import{whenOnce as r}from\"../../../core/reactiveUtils.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{LayerView3D as a}from\"./LayerView3D.js\";import{TiledLayerView3D as l}from\"./TiledLayerView3D.js\";import{RasterTile as n}from\"../terrain/RasterTile.js\";import o from\"../../layers/ImageryTileLayerView.js\";import m from\"../../layers/LayerView.js\";import p from\"../../layers/RefreshableLayerView.js\";import{createQueryGeometry as h}from\"../../support/drapedUtils.js\";import{getWebGLCapabilities as c}from\"../../webgl/capabilities.js\";let y=class extends(o(p(l(a(m))))){constructor(){super(...arguments),this.type=\"imagery-tile-3d\",this.isAlignedMapTile=!0}initialize(){this.layer.increaseRasterJobHandlerUsage(),null==this.fullExtent&&this.addResolvingPromise(Promise.reject(new t(\"layerview:spatial-reference-incompatible\",\"The layer extent cannot be projected to the view's spatial reference\",{layer:this.layer})));const e=r((()=>this.view?.basemapTerrain?.tilingSchemeLocked)).then((()=>{const e=this.view.basemapTerrain.tilingScheme,t=this.layer.tileInfo,r=[\"png\",\"png24\",\"png32\",\"jpg\",\"mixed\"].includes(t.format)&&e.compatibleWith(t);this.isAlignedMapTile=r;const i=r?t:e.toTileInfo();this.tileInfo=i,this.updatingHandles.add((()=>[this.layer.renderer,this.layer.interpolation,this.layer.bandIds,this.layer.multidimensionalDefinition,this.layer.multidimensionalSubset,this.layer.rasterFunction,this.timeExtent]),(()=>this.refresh()))}));this.addResolvingPromise(e)}destroy(){this.layer.decreaseRasterJobHandlerUsage(),this.view=null}get _blankTile(){const e=document.createElement(\"canvas\"),t=e.getContext(\"2d\"),[r,i]=this.tileInfo.size;return e.width=r,e.height=i,t.clearRect(0,0,r,i),t.getImageData(0,0,r,i)}get imageFormatIsOpaque(){return\"jpg\"===this.layer.tileInfo.format}get hasMixedImageFormats(){return\"mixed\"===this.layer.tileInfo.format}get dataLevelRange(){const e=this.tileInfo.lods,t=this.layer.tileInfo.lods,r=e[0].scale,i=t[t.length-1].scale;return this.levelRangeFromScaleRange(r,i)}_getfullExtent(){return this.projectFullExtent(this.view.basemapTerrain&&null!=this.view.basemapTerrain.spatialReference?this.view.basemapTerrain.spatialReference:this.view.spatialReference)}async fetchTile(e,t,r,i){const s=this.tileInfo,a=this._canSymbolizeInWebGL(),l={tileInfo:s,requestRawData:a,signal:i.signal,timeExtent:this.timeExtent,requestAsImageElement:this.isAlignedMapTile},o=await this.layer.fetchTile(e,t,r,l);if(o instanceof HTMLImageElement)return o;let m=o&&o.pixelBlock;if(null==m)return this._blankTile;if(!a&&(m=await this.layer.applyRenderer(o),null==m))return this._blankTile;const p=new n([e,t,r],m,s.size[0],s.size[1]);return a?(p.symbolizerRenderer=this.layer.symbolizer.rendererJSON,p.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e)),p.transformGrid=o.transformGrid):p.isRendereredSource=!0,p.interpolation=this.layer.interpolation,p.bandIds=this.layer.bandIds,p}_getSymbolizerOptions(e){const t=this.tileInfo.lodAt(e).resolution;return{pixelBlock:null,isGCS:this.view.basemapTerrain&&null!=this.view.basemapTerrain.spatialReference?this.view.basemapTerrain.spatialReference.isGeographic:this.view.spatialReference.isGeographic,resolution:{x:t,y:t},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(e){this._canSymbolizeInWebGL()&&JSON.stringify(e.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(e.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])))}createFetchPopupFeaturesQueryGeometry(e,t){return h(e,t,this.view)}refresh(){this.emit(\"data-changed\")}async doRefresh(){this.suspended||this.emit(\"data-changed\")}_canSymbolizeInWebGL(){return c(\"3d\").supportsTextureFloat&&this.layer.symbolizer.canRenderInWebGL}};e([i({readOnly:!0})],y.prototype,\"_blankTile\",null),e([i({readOnly:!0})],y.prototype,\"imageFormatIsOpaque\",null),e([i({readOnly:!0})],y.prototype,\"hasMixedImageFormats\",null),e([i({readOnly:!0})],y.prototype,\"dataLevelRange\",null),y=e([s(\"esri.views.3d.layers.ImageryTileLayerView3D\")],y);const d=y;export{d as default};\n"],
  "mappings": "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",
  "names": ["p", "e", "r", "o", "s", "a", "n", "u", "i", "y", "p", "a", "n", "e", "r", "s", "o", "m", "d"]
}
