{
  "version": 3,
  "sources": ["../../@arcgis/core/views/layers/ImageryLayerView.js", "../../@arcgis/core/views/3d/layers/ImageryLayerView3D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import s from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as p}from\"../../layers/support/commonProperties.js\";import i from\"../../rest/support/Query.js\";import{getFetchPopupTemplate as a}from\"./support/popupUtils.js\";const n=n=>{let u=class extends n{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,t){const{layer:o}=this;if(!e)throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:o});const{popupEnabled:p}=o,n=a(o,t);if(!p||null==n)throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:p,popupTemplate:n});const u=await n.getRequiredFields(),l=new i;l.timeExtent=this.timeExtent,l.geometry=e,l.outFields=u,l.outSpatialReference=e.spatialReference;const{resolution:m,spatialReference:c}=this.view,y=\"2d\"===this.view.type?new s(m,m,c):new s(.5*m,.5*m,c),{returnTopmostRaster:d,showNoDataRecords:h}=n.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},w={returnDomainValues:!0,returnTopmostRaster:d,pixelSize:y,showNoDataRecords:h,signal:null!=t?t.signal:null};return o.queryVisibleRasters(l,w).then((e=>e))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e([t()],u.prototype,\"layer\",void 0),e([t()],u.prototype,\"suspended\",void 0),e([t(p)],u.prototype,\"timeExtent\",void 0),e([t()],u.prototype,\"view\",void 0),u=e([o(\"esri.views.layers.ImageryLayerView\")],u),u};export{n as default};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{debounce as a}from\"../../../core/promiseUtils.js\";import{when as t}from\"../../../core/reactiveUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/Error.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import r from\"./DynamicLayerView3D.js\";import s from\"../../layers/ImageryLayerView.js\";let o=class extends(s(r)){constructor(){super(...arguments),this.type=\"imagery-3d\",this.redrawDebounced=a((async e=>{this.redraw(((e,a)=>this._redrawImage(e,a)),e)}),2e3)}initialize(){this.handles.add([t((()=>this.view.basemapTerrain.ready),(()=>this._initializeMaximumDataResolution()),{once:!0,initial:!0}),this.layer.on(\"redraw\",(()=>this.updatingHandles.addPromise(this.redrawDebounced())))]),this.updatingHandles.add((()=>this.layer?.exportImageServiceParameters?.version),(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add((()=>this.layer?.renderer),(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add((()=>this.timeExtent),(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,a,t){a.imageOrCanvasElement?e.image=a.imageOrCanvasElement:(e.image=document.createElement(\"canvas\"),e.pixelData=a.pixelData,await this._redrawImage(e,t))}async _redrawImage(e,a){if(!(e.image instanceof HTMLCanvasElement)||null==e.pixelData)throw new Error;const t=e.image,i=t.getContext(\"2d\"),r=await this.layer.applyRenderer(e.pixelData,{signal:a}),s=this.layer.applyFilter(r).pixelBlock;if(null==s)throw new Error;t.width=s.width,t.height=s.height;const o=i.createImageData(s.width,s.height);o.data.set(s.getAsRGBA()),i.putImageData(o,0,0)}};o=e([i(\"esri.views.3d.layers.ImageryLayerView3D\")],o);const n=o;export{n as default};\n"],
  "mappings": "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",
  "names": ["n", "e", "o", "p", "u", "b", "y", "e", "a", "s", "o", "n"]
}
