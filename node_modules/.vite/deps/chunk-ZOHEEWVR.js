import {
  e,
  r as r3
} from "./chunk-FKUVQAN6.js";
import {
  o
} from "./chunk-3OC6TISQ.js";
import {
  G,
  Me,
  Q,
  V,
  a2,
  et,
  ie,
  l2 as l,
  ne,
  r,
  t as t3
} from "./chunk-2RY5Y75R.js";
import {
  m
} from "./chunk-XTOI3E3Y.js";
import {
  c as c2
} from "./chunk-QNBIVGAZ.js";
import {
  O,
  a,
  c as c3,
  r as r2,
  t as t4
} from "./chunk-RSPVLZNN.js";
import {
  t as t2
} from "./chunk-OZXJDVTE.js";
import {
  p3 as p
} from "./chunk-5HSVWQOA.js";
import {
  u as u2
} from "./chunk-DOQ3SAAR.js";
import {
  h
} from "./chunk-ZXXKE5XP.js";
import {
  j
} from "./chunk-ZF5PVI2P.js";
import {
  t2 as t
} from "./chunk-OBGBLQQX.js";
import {
  c
} from "./chunk-TEHNQYQD.js";
import {
  n
} from "./chunk-FFUMVAL2.js";
import {
  d,
  s2,
  u
} from "./chunk-UYRCWUYQ.js";
import {
  s3 as s
} from "./chunk-HMVAPW5X.js";

// node_modules/@arcgis/core/chunks/index2.js
var r4;
var n2;
var i = { exports: {} };
i.exports, r4 = i, i.exports, n2 = function() {
  return function(e5) {
    var t6 = {};
    function r8(n6) {
      if (t6[n6])
        return t6[n6].exports;
      var i4 = t6[n6] = { exports: {}, id: n6, loaded: false };
      return e5[n6].call(i4.exports, i4, i4.exports, r8), i4.loaded = true, i4.exports;
    }
    return r8.m = e5, r8.c = t6, r8.p = "", r8(0);
  }([function(e5, t6, r8) {
    Object.defineProperty(t6, "__esModule", { value: true }), t6.isNotPNG = u5, t6.isNotAPNG = h4, t6.default = c6;
    var n6 = s5(r8(1)), i4 = r8(2);
    function s5(e6) {
      return e6 && e6.__esModule ? e6 : { default: e6 };
    }
    var a6 = new Error("Not a PNG"), o4 = new Error("Not an animated PNG");
    function u5(e6) {
      return e6 === a6;
    }
    function h4(e6) {
      return e6 === o4;
    }
    var l5 = new Uint8Array([137, 80, 78, 71, 13, 10, 26, 10]);
    function c6(e6) {
      var t7 = new Uint8Array(e6);
      if (Array.prototype.some.call(l5, function(e7, r10) {
        return e7 !== t7[r10];
      }))
        return a6;
      var r9 = false;
      if (f2(t7, function(e7) {
        return !(r9 = "acTL" === e7);
      }), !r9)
        return o4;
      var n7 = [], s6 = [], u6 = null, h5 = null, c7 = 0, p5 = new i4.APNG();
      if (f2(t7, function(e7, t8, r10, a7) {
        var o5 = new DataView(t8.buffer);
        switch (e7) {
          case "IHDR":
            u6 = t8.subarray(r10 + 8, r10 + 8 + a7), p5.width = o5.getUint32(r10 + 8), p5.height = o5.getUint32(r10 + 12);
            break;
          case "acTL":
            p5.numPlays = o5.getUint32(r10 + 8 + 4);
            break;
          case "fcTL":
            h5 && (p5.frames.push(h5), c7++), (h5 = new i4.Frame()).width = o5.getUint32(r10 + 8 + 4), h5.height = o5.getUint32(r10 + 8 + 8), h5.left = o5.getUint32(r10 + 8 + 12), h5.top = o5.getUint32(r10 + 8 + 16);
            var l6 = o5.getUint16(r10 + 8 + 20), f3 = o5.getUint16(r10 + 8 + 22);
            0 === f3 && (f3 = 100), h5.delay = 1e3 * l6 / f3, h5.delay <= 10 && (h5.delay = 100), p5.playTime += h5.delay, h5.disposeOp = o5.getUint8(r10 + 8 + 24), h5.blendOp = o5.getUint8(r10 + 8 + 25), h5.dataParts = [], 0 === c7 && 2 === h5.disposeOp && (h5.disposeOp = 1);
            break;
          case "fdAT":
            h5 && h5.dataParts.push(t8.subarray(r10 + 8 + 4, r10 + 8 + a7));
            break;
          case "IDAT":
            h5 && h5.dataParts.push(t8.subarray(r10 + 8, r10 + 8 + a7));
            break;
          case "IEND":
            s6.push(v3(t8, r10, 12 + a7));
            break;
          default:
            n7.push(v3(t8, r10, 12 + a7));
        }
      }), h5 && p5.frames.push(h5), 0 == p5.frames.length)
        return o4;
      var m4 = new Blob(n7), y2 = new Blob(s6);
      return p5.frames.forEach(function(e7) {
        var t8 = [];
        t8.push(l5), u6.set(_3(e7.width), 0), u6.set(_3(e7.height), 4), t8.push(d3("IHDR", u6)), t8.push(m4), e7.dataParts.forEach(function(e8) {
          return t8.push(d3("IDAT", e8));
        }), t8.push(y2), e7.imageData = new Blob(t8, { type: "image/png" }), delete e7.dataParts, t8 = null;
      }), p5;
    }
    function f2(e6, t7) {
      var r9 = new DataView(e6.buffer), n7 = 8, i5 = void 0, s6 = void 0, a7 = void 0;
      do {
        s6 = r9.getUint32(n7), a7 = t7(i5 = p4(e6, n7 + 4, 4), e6, n7, s6), n7 += 12 + s6;
      } while (false !== a7 && "IEND" != i5 && n7 < e6.length);
    }
    function p4(e6, t7, r9) {
      var n7 = Array.prototype.slice.call(e6.subarray(t7, t7 + r9));
      return String.fromCharCode.apply(String, n7);
    }
    function m3(e6) {
      for (var t7 = new Uint8Array(e6.length), r9 = 0; r9 < e6.length; r9++)
        t7[r9] = e6.charCodeAt(r9);
      return t7;
    }
    function v3(e6, t7, r9) {
      var n7 = new Uint8Array(r9);
      return n7.set(e6.subarray(t7, t7 + r9)), n7;
    }
    var d3 = function(e6, t7) {
      var r9 = e6.length + t7.length, i5 = new Uint8Array(r9 + 8), s6 = new DataView(i5.buffer);
      s6.setUint32(0, t7.length), i5.set(m3(e6), 4), i5.set(t7, 8);
      var a7 = (0, n6.default)(i5, 4, r9);
      return s6.setUint32(r9 + 4, a7), i5;
    }, _3 = function(e6) {
      return new Uint8Array([e6 >>> 24 & 255, e6 >>> 16 & 255, e6 >>> 8 & 255, 255 & e6]);
    };
  }, function(e5, t6) {
    Object.defineProperty(t6, "__esModule", { value: true }), t6.default = function(e6) {
      for (var t7 = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0, n7 = -1, i5 = t7, s6 = t7 + (arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : e6.length - t7); i5 < s6; i5++)
        n7 = n7 >>> 8 ^ r8[255 & (n7 ^ e6[i5])];
      return -1 ^ n7;
    };
    for (var r8 = new Uint32Array(256), n6 = 0; n6 < 256; n6++) {
      for (var i4 = n6, s5 = 0; s5 < 8; s5++)
        i4 = 0 != (1 & i4) ? 3988292384 ^ i4 >>> 1 : i4 >>> 1;
      r8[n6] = i4;
    }
  }, function(e5, t6, r8) {
    Object.defineProperty(t6, "__esModule", { value: true }), t6.Frame = t6.APNG = void 0;
    var n6 = function() {
      function e6(e7, t7) {
        for (var r9 = 0; r9 < t7.length; r9++) {
          var n7 = t7[r9];
          n7.enumerable = n7.enumerable || false, n7.configurable = true, "value" in n7 && (n7.writable = true), Object.defineProperty(e7, n7.key, n7);
        }
      }
      return function(t7, r9, n7) {
        return r9 && e6(t7.prototype, r9), n7 && e6(t7, n7), t7;
      };
    }(), i4 = s5(r8(3));
    function s5(e6) {
      return e6 && e6.__esModule ? e6 : { default: e6 };
    }
    function a6(e6, t7) {
      if (!(e6 instanceof t7))
        throw new TypeError("Cannot call a class as a function");
    }
    t6.APNG = function() {
      function e6() {
        a6(this, e6), this.width = 0, this.height = 0, this.numPlays = 0, this.playTime = 0, this.frames = [];
      }
      return n6(e6, [{ key: "createImages", value: function() {
        return Promise.all(this.frames.map(function(e7) {
          return e7.createImage();
        }));
      } }, { key: "getPlayer", value: function(e7) {
        var t7 = this, r9 = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
        return this.createImages().then(function() {
          return new i4.default(t7, e7, r9);
        });
      } }]), e6;
    }(), t6.Frame = function() {
      function e6() {
        a6(this, e6), this.left = 0, this.top = 0, this.width = 0, this.height = 0, this.delay = 0, this.disposeOp = 0, this.blendOp = 0, this.imageData = null, this.imageElement = null;
      }
      return n6(e6, [{ key: "createImage", value: function() {
        var e7 = this;
        return this.imageElement ? Promise.resolve() : new Promise(function(t7, r9) {
          var n7 = URL.createObjectURL(e7.imageData);
          e7.imageElement = document.createElement("img"), e7.imageElement.onload = function() {
            URL.revokeObjectURL(n7), t7();
          }, e7.imageElement.onerror = function() {
            URL.revokeObjectURL(n7), e7.imageElement = null, r9(new Error("Image creation error"));
          }, e7.imageElement.src = n7;
        });
      } }]), e6;
    }();
  }, function(e5, t6, r8) {
    Object.defineProperty(t6, "__esModule", { value: true });
    var n6 = function() {
      function e6(e7, t7) {
        for (var r9 = 0; r9 < t7.length; r9++) {
          var n7 = t7[r9];
          n7.enumerable = n7.enumerable || false, n7.configurable = true, "value" in n7 && (n7.writable = true), Object.defineProperty(e7, n7.key, n7);
        }
      }
      return function(t7, r9, n7) {
        return r9 && e6(t7.prototype, r9), n7 && e6(t7, n7), t7;
      };
    }();
    function i4(e6) {
      return e6 && e6.__esModule ? e6 : { default: e6 };
    }
    function s5(e6, t7) {
      if (!(e6 instanceof t7))
        throw new TypeError("Cannot call a class as a function");
    }
    function a6(e6, t7) {
      if (!e6)
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
      return !t7 || "object" != typeof t7 && "function" != typeof t7 ? e6 : t7;
    }
    function o4(e6, t7) {
      if ("function" != typeof t7 && null !== t7)
        throw new TypeError("Super expression must either be null or a function, not " + typeof t7);
      e6.prototype = Object.create(t7 && t7.prototype, { constructor: { value: e6, enumerable: false, writable: true, configurable: true } }), t7 && (Object.setPrototypeOf ? Object.setPrototypeOf(e6, t7) : e6.__proto__ = t7);
    }
    var u5 = function(e6) {
      function t7(e7, r9, n7) {
        s5(this, t7);
        var i5 = a6(this, (t7.__proto__ || Object.getPrototypeOf(t7)).call(this));
        return i5.playbackRate = 1, i5._currentFrameNumber = 0, i5._ended = false, i5._paused = true, i5._numPlays = 0, i5._apng = e7, i5.context = r9, i5.stop(), n7 && i5.play(), i5;
      }
      return o4(t7, e6), n6(t7, [{ key: "renderNextFrame", value: function() {
        this._currentFrameNumber = (this._currentFrameNumber + 1) % this._apng.frames.length, this._currentFrameNumber === this._apng.frames.length - 1 && (this._numPlays++, 0 !== this._apng.numPlays && this._numPlays >= this._apng.numPlays && (this._ended = true, this._paused = true)), this._prevFrame && 1 == this._prevFrame.disposeOp ? this.context.clearRect(this._prevFrame.left, this._prevFrame.top, this._prevFrame.width, this._prevFrame.height) : this._prevFrame && 2 == this._prevFrame.disposeOp && this.context.putImageData(this._prevFrameData, this._prevFrame.left, this._prevFrame.top);
        var e7 = this.currentFrame;
        this._prevFrame = e7, this._prevFrameData = null, 2 == e7.disposeOp && (this._prevFrameData = this.context.getImageData(e7.left, e7.top, e7.width, e7.height)), 0 == e7.blendOp && this.context.clearRect(e7.left, e7.top, e7.width, e7.height), this.context.drawImage(e7.imageElement, e7.left, e7.top), this.emit("frame", this._currentFrameNumber), this._ended && this.emit("end");
      } }, { key: "play", value: function() {
        var e7 = this;
        this.emit("play"), this._ended && this.stop(), this._paused = false;
        var t8 = performance.now() + this.currentFrame.delay / this.playbackRate, r9 = function r10(n7) {
          if (!e7._ended && !e7._paused) {
            if (n7 >= t8) {
              for (; n7 - t8 >= e7._apng.playTime / e7.playbackRate; )
                t8 += e7._apng.playTime / e7.playbackRate, e7._numPlays++;
              do {
                e7.renderNextFrame(), t8 += e7.currentFrame.delay / e7.playbackRate;
              } while (!e7._ended && n7 > t8);
            }
            requestAnimationFrame(r10);
          }
        };
        requestAnimationFrame(r9);
      } }, { key: "pause", value: function() {
        this._paused || (this.emit("pause"), this._paused = true);
      } }, { key: "stop", value: function() {
        this.emit("stop"), this._numPlays = 0, this._ended = false, this._paused = true, this._currentFrameNumber = -1, this.context.clearRect(0, 0, this._apng.width, this._apng.height), this.renderNextFrame();
      } }, { key: "currentFrameNumber", get: function() {
        return this._currentFrameNumber;
      } }, { key: "currentFrame", get: function() {
        return this._apng.frames[this._currentFrameNumber];
      } }, { key: "paused", get: function() {
        return this._paused;
      } }, { key: "ended", get: function() {
        return this._ended;
      } }]), t7;
    }(i4(r8(4)).default);
    t6.default = u5;
  }, function(e5, t6) {
    function r8() {
      this._events = this._events || {}, this._maxListeners = this._maxListeners || void 0;
    }
    function n6(e6) {
      return "function" == typeof e6;
    }
    function i4(e6) {
      return "number" == typeof e6;
    }
    function s5(e6) {
      return "object" == typeof e6 && null !== e6;
    }
    function a6(e6) {
      return void 0 === e6;
    }
    e5.exports = r8, r8.EventEmitter = r8, r8.prototype._events = void 0, r8.prototype._maxListeners = void 0, r8.defaultMaxListeners = 10, r8.prototype.setMaxListeners = function(e6) {
      if (!i4(e6) || e6 < 0 || isNaN(e6))
        throw TypeError("n must be a positive number");
      return this._maxListeners = e6, this;
    }, r8.prototype.emit = function(e6) {
      var t7, r9, i5, o4, u5, h4;
      if (this._events || (this._events = {}), "error" === e6 && (!this._events.error || s5(this._events.error) && !this._events.error.length)) {
        if ((t7 = arguments[1]) instanceof Error)
          throw t7;
        var l5 = new Error('Uncaught, unspecified "error" event. (' + t7 + ")");
        throw l5.context = t7, l5;
      }
      if (a6(r9 = this._events[e6]))
        return false;
      if (n6(r9))
        switch (arguments.length) {
          case 1:
            r9.call(this);
            break;
          case 2:
            r9.call(this, arguments[1]);
            break;
          case 3:
            r9.call(this, arguments[1], arguments[2]);
            break;
          default:
            o4 = Array.prototype.slice.call(arguments, 1), r9.apply(this, o4);
        }
      else if (s5(r9))
        for (o4 = Array.prototype.slice.call(arguments, 1), i5 = (h4 = r9.slice()).length, u5 = 0; u5 < i5; u5++)
          h4[u5].apply(this, o4);
      return true;
    }, r8.prototype.addListener = function(e6, t7) {
      var i5;
      if (!n6(t7))
        throw TypeError("listener must be a function");
      return this._events || (this._events = {}), this._events.newListener && this.emit("newListener", e6, n6(t7.listener) ? t7.listener : t7), this._events[e6] ? s5(this._events[e6]) ? this._events[e6].push(t7) : this._events[e6] = [this._events[e6], t7] : this._events[e6] = t7, s5(this._events[e6]) && !this._events[e6].warned && (i5 = a6(this._maxListeners) ? r8.defaultMaxListeners : this._maxListeners) && i5 > 0 && this._events[e6].length > i5 && (this._events[e6].warned = true, console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.", this._events[e6].length), "function" == typeof console.trace && console.trace()), this;
    }, r8.prototype.on = r8.prototype.addListener, r8.prototype.once = function(e6, t7) {
      if (!n6(t7))
        throw TypeError("listener must be a function");
      var r9 = false;
      function i5() {
        this.removeListener(e6, i5), r9 || (r9 = true, t7.apply(this, arguments));
      }
      return i5.listener = t7, this.on(e6, i5), this;
    }, r8.prototype.removeListener = function(e6, t7) {
      var r9, i5, a7, o4;
      if (!n6(t7))
        throw TypeError("listener must be a function");
      if (!this._events || !this._events[e6])
        return this;
      if (a7 = (r9 = this._events[e6]).length, i5 = -1, r9 === t7 || n6(r9.listener) && r9.listener === t7)
        delete this._events[e6], this._events.removeListener && this.emit("removeListener", e6, t7);
      else if (s5(r9)) {
        for (o4 = a7; o4-- > 0; )
          if (r9[o4] === t7 || r9[o4].listener && r9[o4].listener === t7) {
            i5 = o4;
            break;
          }
        if (i5 < 0)
          return this;
        1 === r9.length ? (r9.length = 0, delete this._events[e6]) : r9.splice(i5, 1), this._events.removeListener && this.emit("removeListener", e6, t7);
      }
      return this;
    }, r8.prototype.removeAllListeners = function(e6) {
      var t7, r9;
      if (!this._events)
        return this;
      if (!this._events.removeListener)
        return 0 === arguments.length ? this._events = {} : this._events[e6] && delete this._events[e6], this;
      if (0 === arguments.length) {
        for (t7 in this._events)
          "removeListener" !== t7 && this.removeAllListeners(t7);
        return this.removeAllListeners("removeListener"), this._events = {}, this;
      }
      if (n6(r9 = this._events[e6]))
        this.removeListener(e6, r9);
      else if (r9)
        for (; r9.length; )
          this.removeListener(e6, r9[r9.length - 1]);
      return delete this._events[e6], this;
    }, r8.prototype.listeners = function(e6) {
      return this._events && this._events[e6] ? n6(this._events[e6]) ? [this._events[e6]] : this._events[e6].slice() : [];
    }, r8.prototype.listenerCount = function(e6) {
      if (this._events) {
        var t7 = this._events[e6];
        if (n6(t7))
          return 1;
        if (t7)
          return t7.length;
      }
      return 0;
    }, r8.listenerCount = function(e6, t7) {
      return e6.listenerCount(t7);
    };
  }]);
}, r4.exports = n2();
var s3 = t2(i.exports);

// node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/apng.js
async function r5(r8, n6) {
  const i4 = s3(r8);
  if (i4 instanceof Error)
    throw i4;
  await i4.createImages(), s2(n6);
  const { frames: a6, width: s5, height: p4 } = i4, c6 = document.createElement("canvas");
  c6.width = s5, c6.height = p4;
  const l5 = c6.getContext("2d", { willReadFrequently: true }), m3 = [], h4 = [];
  for (const t6 of a6) {
    h4.push(n(t6.delay || 100));
    const e5 = t6.imageElement;
    0 === t6.blendOp ? l5.globalCompositeOperation = "copy" : l5.globalCompositeOperation = "source-over";
    const r9 = 2 === t6.disposeOp ? l5.getImageData(t6.left, t6.top, t6.width, t6.height) : void 0;
    l5.drawImage(e5, t6.left, t6.top);
    const n7 = l5.getImageData(0, 0, s5, p4);
    m3.push(n7), 0 === t6.disposeOp || (1 === t6.disposeOp ? l5.clearRect(t6.left, t6.top, t6.width, t6.height) : 2 === t6.disposeOp && l5.putImageData(r9, t6.left, t6.top));
  }
  return { frameDurations: h4, getFrame: (t6) => m3[t6], width: s5, height: p4 };
}
var n3 = [137, 80, 78, 71, 13, 10, 26, 10];
function i2(t6) {
  const e5 = new Uint8Array(t6);
  return !n3.some((t7, o4) => t7 !== e5[o4]);
}
function a3(t6) {
  if (!i2(t6))
    return false;
  const e5 = new DataView(t6), o4 = new Uint8Array(t6);
  let r8, n6 = 8;
  do {
    const t7 = e5.getUint32(n6);
    if (r8 = String.fromCharCode.apply(String, Array.prototype.slice.call(o4.subarray(n6 + 4, n6 + 8))), "acTL" === r8)
      return true;
    n6 += 12 + t7;
  } while ("IEND" !== r8 && n6 < o4.length);
  return false;
}

// node_modules/@arcgis/core/chunks/index3.js
var e3 = {};
var r6 = {};
var t5 = {};
Object.defineProperty(t5, "__esModule", { value: true }), t5.loop = t5.conditional = t5.parse = void 0;
var n4 = function e4(r8, t6) {
  var n6 = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}, a6 = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : n6;
  if (Array.isArray(t6))
    t6.forEach(function(t7) {
      return e4(r8, t7, n6, a6);
    });
  else if ("function" == typeof t6)
    t6(r8, n6, a6, e4);
  else {
    var i4 = Object.keys(t6)[0];
    Array.isArray(t6[i4]) ? (a6[i4] = {}, e4(r8, t6[i4], n6, a6[i4])) : a6[i4] = t6[i4](r8, n6, a6, e4);
  }
  return n6;
};
t5.parse = n4;
var a4 = function(e5, r8) {
  return function(t6, n6, a6, i4) {
    r8(t6, n6, a6) && i4(t6, e5, n6, a6);
  };
};
t5.conditional = a4;
var i3 = function(e5, r8) {
  return function(t6, n6, a6, i4) {
    for (var o4 = [], d3 = t6.pos; r8(t6, n6, a6); ) {
      var s5 = {};
      if (i4(t6, e5, n6, s5), t6.pos === d3)
        break;
      d3 = t6.pos, o4.push(s5);
    }
    return o4;
  };
};
t5.loop = i3;
var o2 = {};
Object.defineProperty(o2, "__esModule", { value: true }), o2.readBits = o2.readArray = o2.readUnsigned = o2.readString = o2.peekBytes = o2.readBytes = o2.peekByte = o2.readByte = o2.buildStream = void 0;
var d2 = function(e5) {
  return { data: e5, pos: 0 };
};
o2.buildStream = d2;
var s4 = function() {
  return function(e5) {
    return e5.data[e5.pos++];
  };
};
o2.readByte = s4;
var c4 = function() {
  var e5 = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0;
  return function(r8) {
    return r8.data[r8.pos + e5];
  };
};
o2.peekByte = c4;
var u3 = function(e5) {
  return function(r8) {
    return r8.data.subarray(r8.pos, r8.pos += e5);
  };
};
o2.readBytes = u3;
var l2 = function(e5) {
  return function(r8) {
    return r8.data.subarray(r8.pos, r8.pos + e5);
  };
};
o2.peekBytes = l2;
var f = function(e5) {
  return function(r8) {
    return Array.from(u3(e5)(r8)).map(function(e6) {
      return String.fromCharCode(e6);
    }).join("");
  };
};
o2.readString = f;
var p2 = function(e5) {
  return function(r8) {
    var t6 = u3(2)(r8);
    return e5 ? (t6[1] << 8) + t6[0] : (t6[0] << 8) + t6[1];
  };
};
o2.readUnsigned = p2;
var y = function(e5, r8) {
  return function(t6, n6, a6) {
    for (var i4 = "function" == typeof r8 ? r8(t6, n6, a6) : r8, o4 = u3(e5), d3 = new Array(i4), s5 = 0; s5 < i4; s5++)
      d3[s5] = o4(t6);
    return d3;
  };
};
o2.readArray = y;
var v = function(e5, r8, t6) {
  for (var n6 = 0, a6 = 0; a6 < t6; a6++)
    n6 += e5[r8 + a6] && Math.pow(2, t6 - a6 - 1);
  return n6;
};
var g = function(e5) {
  return function(r8) {
    for (var t6 = s4()(r8), n6 = new Array(8), a6 = 0; a6 < 8; a6++)
      n6[7 - a6] = !!(t6 & 1 << a6);
    return Object.keys(e5).reduce(function(r9, t7) {
      var a7 = e5[t7];
      return a7.length ? r9[t7] = v(n6, a7.index, a7.length) : r9[t7] = n6[a7.index], r9;
    }, {});
  };
};
o2.readBits = g, function(e5) {
  Object.defineProperty(e5, "__esModule", { value: true }), e5.default = void 0;
  var r8 = t5, n6 = o2, a6 = { blocks: function(e6) {
    for (var r9 = 0, t6 = [], a7 = e6.data.length, i5 = 0, o4 = (0, n6.readByte)()(e6); o4 !== r9 && o4; o4 = (0, n6.readByte)()(e6)) {
      if (e6.pos + o4 >= a7) {
        var d4 = a7 - e6.pos;
        t6.push((0, n6.readBytes)(d4)(e6)), i5 += d4;
        break;
      }
      t6.push((0, n6.readBytes)(o4)(e6)), i5 += o4;
    }
    for (var s6 = new Uint8Array(i5), c7 = 0, u6 = 0; u6 < t6.length; u6++)
      s6.set(t6[u6], c7), c7 += t6[u6].length;
    return s6;
  } }, i4 = (0, r8.conditional)({ gce: [{ codes: (0, n6.readBytes)(2) }, { byteSize: (0, n6.readByte)() }, { extras: (0, n6.readBits)({ future: { index: 0, length: 3 }, disposal: { index: 3, length: 3 }, userInput: { index: 6 }, transparentColorGiven: { index: 7 } }) }, { delay: (0, n6.readUnsigned)(true) }, { transparentColorIndex: (0, n6.readByte)() }, { terminator: (0, n6.readByte)() }] }, function(e6) {
    var r9 = (0, n6.peekBytes)(2)(e6);
    return 33 === r9[0] && 249 === r9[1];
  }), d3 = (0, r8.conditional)({ image: [{ code: (0, n6.readByte)() }, { descriptor: [{ left: (0, n6.readUnsigned)(true) }, { top: (0, n6.readUnsigned)(true) }, { width: (0, n6.readUnsigned)(true) }, { height: (0, n6.readUnsigned)(true) }, { lct: (0, n6.readBits)({ exists: { index: 0 }, interlaced: { index: 1 }, sort: { index: 2 }, future: { index: 3, length: 2 }, size: { index: 5, length: 3 } }) }] }, (0, r8.conditional)({ lct: (0, n6.readArray)(3, function(e6, r9, t6) {
    return Math.pow(2, t6.descriptor.lct.size + 1);
  }) }, function(e6, r9, t6) {
    return t6.descriptor.lct.exists;
  }), { data: [{ minCodeSize: (0, n6.readByte)() }, a6] }] }, function(e6) {
    return 44 === (0, n6.peekByte)()(e6);
  }), s5 = (0, r8.conditional)({ text: [{ codes: (0, n6.readBytes)(2) }, { blockSize: (0, n6.readByte)() }, { preData: function(e6, r9, t6) {
    return (0, n6.readBytes)(t6.text.blockSize)(e6);
  } }, a6] }, function(e6) {
    var r9 = (0, n6.peekBytes)(2)(e6);
    return 33 === r9[0] && 1 === r9[1];
  }), c6 = (0, r8.conditional)({ application: [{ codes: (0, n6.readBytes)(2) }, { blockSize: (0, n6.readByte)() }, { id: function(e6, r9, t6) {
    return (0, n6.readString)(t6.blockSize)(e6);
  } }, a6] }, function(e6) {
    var r9 = (0, n6.peekBytes)(2)(e6);
    return 33 === r9[0] && 255 === r9[1];
  }), u5 = (0, r8.conditional)({ comment: [{ codes: (0, n6.readBytes)(2) }, a6] }, function(e6) {
    var r9 = (0, n6.peekBytes)(2)(e6);
    return 33 === r9[0] && 254 === r9[1];
  }), l5 = [{ header: [{ signature: (0, n6.readString)(3) }, { version: (0, n6.readString)(3) }] }, { lsd: [{ width: (0, n6.readUnsigned)(true) }, { height: (0, n6.readUnsigned)(true) }, { gct: (0, n6.readBits)({ exists: { index: 0 }, resolution: { index: 1, length: 3 }, sort: { index: 4 }, size: { index: 5, length: 3 } }) }, { backgroundColorIndex: (0, n6.readByte)() }, { pixelAspectRatio: (0, n6.readByte)() }] }, (0, r8.conditional)({ gct: (0, n6.readArray)(3, function(e6, r9) {
    return Math.pow(2, r9.lsd.gct.size + 1);
  }) }, function(e6, r9) {
    return r9.lsd.gct.exists;
  }), { frames: (0, r8.loop)([i4, c6, u5, d3, s5], function(e6) {
    var r9 = (0, n6.peekByte)()(e6);
    return 33 === r9 || 44 === r9;
  }) }];
  e5.default = l5;
}(r6);
var h2 = {};
Object.defineProperty(h2, "__esModule", { value: true }), h2.deinterlace = void 0;
var B = function(e5, r8) {
  for (var t6 = new Array(e5.length), n6 = e5.length / r8, a6 = function(n7, a7) {
    var i5 = e5.slice(a7 * r8, (a7 + 1) * r8);
    t6.splice.apply(t6, [n7 * r8, r8].concat(i5));
  }, i4 = [0, 4, 2, 1], o4 = [8, 8, 4, 2], d3 = 0, s5 = 0; s5 < 4; s5++)
    for (var c6 = i4[s5]; c6 < n6; c6 += o4[s5])
      a6(c6, d3), d3++;
  return t6;
};
h2.deinterlace = B;
var x = {};
Object.defineProperty(x, "__esModule", { value: true }), x.lzw = void 0;
var m2 = function(e5, r8, t6) {
  var n6, a6, i4, o4, d3, s5, c6, u5, l5, f2, p4, y2, v3, g2, h4, B2, x2 = 4096, m3 = -1, b3 = t6, w2 = new Array(t6), k2 = new Array(x2), A2 = new Array(x2), S2 = new Array(x2 + 1);
  for (d3 = (a6 = 1 << (f2 = e5)) + 1, n6 = a6 + 2, c6 = m3, i4 = (1 << (o4 = f2 + 1)) - 1, u5 = 0; u5 < a6; u5++)
    k2[u5] = 0, A2[u5] = u5;
  for (p4 = y2 = v3 = g2 = h4 = B2 = 0, l5 = 0; l5 < b3; ) {
    if (0 === g2) {
      if (y2 < o4) {
        p4 += r8[B2] << y2, y2 += 8, B2++;
        continue;
      }
      if (u5 = p4 & i4, p4 >>= o4, y2 -= o4, u5 > n6 || u5 == d3)
        break;
      if (u5 == a6) {
        i4 = (1 << (o4 = f2 + 1)) - 1, n6 = a6 + 2, c6 = m3;
        continue;
      }
      if (c6 == m3) {
        S2[g2++] = A2[u5], c6 = u5, v3 = u5;
        continue;
      }
      for (s5 = u5, u5 == n6 && (S2[g2++] = v3, u5 = c6); u5 > a6; )
        S2[g2++] = A2[u5], u5 = k2[u5];
      v3 = 255 & A2[u5], S2[g2++] = v3, n6 < x2 && (k2[n6] = c6, A2[n6] = v3, 0 == (++n6 & i4) && n6 < x2 && (o4++, i4 += n6)), c6 = s5;
    }
    g2--, w2[h4++] = S2[g2], l5++;
  }
  for (l5 = h4; l5 < b3; l5++)
    w2[l5] = 0;
  return w2;
};
x.lzw = m2, Object.defineProperty(e3, "__esModule", { value: true });
var b = e3.decompressFrames = e3.decompressFrame = C = e3.parseGIF = void 0;
var w = _(r6);
var k = t5;
var A = o2;
var S = h2;
var z = x;
function _(e5) {
  return e5 && e5.__esModule ? e5 : { default: e5 };
}
var U = function(e5) {
  var r8 = new Uint8Array(e5);
  return (0, k.parse)((0, A.buildStream)(r8), w.default);
};
var C = e3.parseGIF = U;
var M = function(e5) {
  for (var r8 = e5.pixels.length, t6 = new Uint8ClampedArray(4 * r8), n6 = 0; n6 < r8; n6++) {
    var a6 = 4 * n6, i4 = e5.pixels[n6], o4 = e5.colorTable[i4] || [0, 0, 0];
    t6[a6] = o4[0], t6[a6 + 1] = o4[1], t6[a6 + 2] = o4[2], t6[a6 + 3] = i4 !== e5.transparentIndex ? 255 : 0;
  }
  return t6;
};
var j2 = function(e5, r8, t6) {
  if (e5.image) {
    var n6 = e5.image, a6 = n6.descriptor.width * n6.descriptor.height, i4 = (0, z.lzw)(n6.data.minCodeSize, n6.data.blocks, a6);
    n6.descriptor.lct.interlaced && (i4 = (0, S.deinterlace)(i4, n6.descriptor.width));
    var o4 = { pixels: i4, dims: { top: e5.image.descriptor.top, left: e5.image.descriptor.left, width: e5.image.descriptor.width, height: e5.image.descriptor.height } };
    return n6.descriptor.lct && n6.descriptor.lct.exists ? o4.colorTable = n6.lct : o4.colorTable = r8, e5.gce && (o4.delay = 10 * (e5.gce.delay || 10), o4.disposalType = e5.gce.extras.disposal, e5.gce.extras.transparentColorGiven && (o4.transparentIndex = e5.gce.transparentColorIndex)), t6 && (o4.patch = M(o4)), o4;
  }
  console.warn("gif frame does not have associated image.");
};
e3.decompressFrame = j2;
var I = function(e5, r8) {
  return e5.frames.filter(function(e6) {
    return e6.image;
  }).map(function(t6) {
    return j2(t6, e5.gct, r8);
  });
};
b = e3.decompressFrames = I;

// node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/gif.js
async function n5(n6, a6) {
  const r8 = C(n6), o4 = b(r8, true), { width: c6, height: d3 } = r8.lsd, m3 = document.createElement("canvas");
  m3.width = c6, m3.height = d3;
  const u5 = m3.getContext("2d", { willReadFrequently: true }), f2 = [], h4 = [];
  for (const i4 of o4) {
    h4.push(n(i4.delay || 100));
    const s5 = new ImageData(i4.patch, i4.dims.width, i4.dims.height), n7 = o(s5), a7 = 3 === i4.disposalType ? u5.getImageData(i4.dims.left, i4.dims.top, i4.dims.width, i4.dims.height) : void 0;
    u5.drawImage(n7, i4.dims.left, i4.dims.top);
    const r9 = u5.getImageData(0, 0, c6, d3);
    f2.push(r9), 1 === i4.disposalType || (2 === i4.disposalType ? u5.clearRect(i4.dims.left, i4.dims.top, i4.dims.width, i4.dims.height) : 3 === i4.disposalType && u5.putImageData(a7, i4.dims.left, i4.dims.top));
  }
  return { frameDurations: h4, getFrame: (t6) => f2[t6], width: c6, height: d3 };
}
var a5 = [71, 73, 70];
function r7(t6) {
  const e5 = new Uint8Array(t6);
  return !a5.some((t7, i4) => t7 !== e5[i4]);
}
function o3(t6) {
  if (!r7(t6))
    return false;
  const e5 = new DataView(t6), i4 = e5.getUint8(10);
  let s5 = 13 + (128 & i4 ? 3 * 2 ** (1 + (7 & i4)) : 0), n6 = 0, a6 = false;
  for (; !a6; ) {
    switch (e5.getUint8(s5++)) {
      case 33:
        if (!o4())
          return false;
        break;
      case 44:
        c6();
        break;
      case 59:
        a6 = true;
        break;
      default:
        return false;
    }
    if (n6 > 1)
      return true;
  }
  function o4() {
    switch (e5.getUint8(s5++)) {
      case 249:
        d3();
        break;
      case 1:
        m3();
        break;
      case 254:
        u5();
        break;
      case 255:
        f2();
        break;
      default:
        return false;
    }
    return true;
  }
  function c6() {
    n6++, s5 += 8;
    const t7 = e5.getUint8(s5++);
    s5 += 128 & t7 ? 3 * 2 ** (1 + (7 & t7)) : 0, s5++, h4();
  }
  function d3() {
    s5++, s5 += 4, h4();
  }
  function m3() {
    n6++, s5++, s5 += 12, h4();
  }
  function u5() {
    h4();
  }
  function f2() {
    s5++, s5 += 8, s5 += 3, h4();
  }
  function h4() {
    let t7;
    for (; t7 = e5.getUint8(s5++); )
      s5 += t7;
  }
  return false;
}

// node_modules/@arcgis/core/symbols/cim/CIMResourceManager.js
var h3 = class {
  constructor() {
    this._resourceMap = /* @__PURE__ */ new Map(), this._inFlightResourceMap = /* @__PURE__ */ new Map(), this.geometryEngine = null, this.geometryEnginePromise = null;
  }
  destroy() {
    this._inFlightResourceMap.clear(), this._resourceMap.clear();
  }
  getResource(e5) {
    return this._resourceMap.get(e5) ?? null;
  }
  async fetchResource(e5, t6) {
    const r8 = this._resourceMap.get(e5);
    if (r8)
      return { width: r8.width, height: r8.height };
    let i4 = this._inFlightResourceMap.get(e5);
    return i4 ? i4.then((e6) => ({ width: e6.width, height: e6.height })) : (i4 = l3(e5, t6), this._inFlightResourceMap.set(e5, i4), i4.then((t7) => (this._inFlightResourceMap.delete(e5), this._resourceMap.set(e5, t7), { width: t7.width, height: t7.height }), () => ({ width: 0, height: 0 })));
  }
  deleteResource(e5) {
    this._inFlightResourceMap.delete(e5), this._resourceMap.delete(e5);
  }
  loadFont(e5) {
    return c2(e5);
  }
};
async function u4(r8, s5) {
  const o4 = window.URL.createObjectURL(r8);
  try {
    const { data: t6 } = await j(o4, { ...s5, responseType: "image" });
    return t6;
  } catch (n6) {
    if (!d(n6))
      throw new s("mapview-invalid-resource", `Could not fetch requested resource at ${o4}`);
    throw n6;
  } finally {
    window.URL.revokeObjectURL(o4);
  }
}
async function l3(e5, t6) {
  const { arrayBuffer: r8, mediaType: i4 } = await p3(e5, t6), s5 = "image/png" === i4;
  if ("image/gif" === i4 && o3(r8))
    return n5(r8);
  if (s5 && a3(r8))
    return r5(r8, t6);
  return u4(new Blob([r8], { type: i4 }), t6);
}
async function p3(r8, o4) {
  let n6;
  const a6 = ";base64,";
  if (r8.includes(a6)) {
    const e5 = r8.indexOf(a6), t6 = r8.indexOf(a6) + a6.length, i4 = r8.substring(t6);
    n6 = { arrayBuffer: t(i4), mediaType: r8.substring(0, e5).replace("data:", "") };
  } else
    try {
      const t6 = await j(r8, { responseType: "array-buffer", ...o4 }), i4 = t6.data;
      n6 = { arrayBuffer: i4, mediaType: t6.getHeader("Content-Type") };
    } catch (c6) {
      if (!d(c6))
        throw new s("mapview-invalid-resource", `Could not fetch requested resource at ${r8}`);
    }
  return n6;
}

// node_modules/@arcgis/core/symbols/cim/Rasterizer.js
var l4 = 512;
var c5 = class {
  constructor(e5) {
    this._resourceManager = e5, this._rasterizationCanvas = null;
  }
  dispose() {
    this._rasterizationCanvas = null;
  }
  rasterizeJSONResource(m3, l5, c6) {
    if (this._rasterizationCanvas || (this._rasterizationCanvas = document.createElement("canvas")), "simple-fill" === m3.type || "esriSFS" === m3.type) {
      const [t6, a6, i4] = r3(this._rasterizationCanvas, m3.style, l5);
      return { size: [a6, i4], image: new Uint32Array(t6.buffer), sdf: false, simplePattern: true, anchorX: 0, anchorY: 0, rasterizationScale: c(Math.ceil(l5)) };
    }
    if ("simple-line" === m3.type || "esriSLS" === m3.type || "line" === m3.type && m3.dashTemplate) {
      let e5, a6;
      if ("simple-line" === m3.type || "esriSLS" === m3.type)
        switch (e5 = Me(m3.style, m3.cap), m3.cap) {
          case "butt":
            a6 = "Butt";
            break;
          case "square":
            a6 = "Square";
            break;
          default:
            a6 = "Round";
        }
      else
        e5 = m3.dashTemplate, a6 = m3.cim.capStyle;
      const [r8, n6, s5] = e(e5, a6);
      return { size: [n6, s5], image: new Uint32Array(r8.buffer), sdf: true, simplePattern: true, anchorX: 0, anchorY: 0 };
    }
    let f2, h4 = null, p4 = null, u5 = 1;
    if ("simple-marker" === m3.type || "esriSMS" === m3.type || "line-marker" === m3.type ? (f2 = ie.fromSimpleMarker(m3), p4 = l(f2)) : m3.cim && "CIMHatchFill" === m3.cim.type ? (f2 = ie.fromCIMHatchFill(m3.cim, l5), h4 = new t3(f2.frame.xmin, -f2.frame.ymax, f2.frame.xmax - f2.frame.xmin, f2.frame.ymax - f2.frame.ymin), u5 = l5) : m3.cim.markerPlacement && "CIMMarkerPlacementInsidePolygon" === m3.cim.markerPlacement.type ? (f2 = ie.fromCIMInsidePolygon(m3.cim), h4 = new t3(f2.frame.xmin, -f2.frame.ymax, f2.frame.xmax - f2.frame.xmin, f2.frame.ymax - f2.frame.ymin)) : (f2 = m3.cim, m3.avoidSDFRasterization || (p4 = l(f2))), p4 && !c6) {
      const [e5, t6, a6] = a2(p4);
      return e5 ? { size: [t6, a6], image: new Uint32Array(e5.buffer), sdf: true, simplePattern: true, anchorX: 0, anchorY: 0, rasterizationScale: u5 } : null;
    }
    const [y2, d3, C2, g2, z3] = ie.rasterize(this._rasterizationCanvas, f2, h4, this._resourceManager, !c6);
    return y2 ? { size: [d3, C2], image: new Uint32Array(y2.buffer), sdf: false, simplePattern: false, anchorX: g2, anchorY: z3 } : null;
  }
  rasterizeImageResource(e5, t6, a6, r8) {
    this._rasterizationCanvas || (this._rasterizationCanvas = document.createElement("canvas")), this._rasterizationCanvas.width = e5, this._rasterizationCanvas.height = t6;
    const i4 = this._rasterizationCanvas.getContext("2d");
    a6 instanceof ImageData ? i4.putImageData(a6, 0, 0) : (a6.setAttribute("width", `${e5}px`), a6.setAttribute("height", `${t6}px`), i4.drawImage(a6, 0, 0, e5, t6));
    const n6 = i4.getImageData(0, 0, e5, t6), s5 = new Uint8Array(n6.data);
    if (r8) {
      for (const m3 of r8)
        if (m3 && m3.oldColor && 4 === m3.oldColor.length && m3.newColor && 4 === m3.newColor.length) {
          const [e6, t7, a7, r9] = m3.oldColor, [i5, n7, o5, l5] = m3.newColor;
          if (e6 === i5 && t7 === n7 && a7 === o5 && r9 === l5)
            continue;
          for (let m4 = 0; m4 < s5.length; m4 += 4)
            e6 === s5[m4] && t7 === s5[m4 + 1] && a7 === s5[m4 + 2] && r9 === s5[m4 + 3] && (s5[m4] = i5, s5[m4 + 1] = n7, s5[m4 + 2] = o5, s5[m4 + 3] = l5);
        }
    }
    let o4;
    for (let m3 = 0; m3 < s5.length; m3 += 4)
      o4 = s5[m3 + 3] / 255, s5[m3] = s5[m3] * o4, s5[m3 + 1] = s5[m3 + 1] * o4, s5[m3 + 2] = s5[m3 + 2] * o4;
    let c6 = s5, f2 = e5, h4 = t6;
    const p4 = l4;
    if (f2 >= p4 || h4 >= p4) {
      const a7 = f2 / h4;
      a7 > 1 ? (f2 = p4, h4 = Math.round(p4 / a7)) : (h4 = p4, f2 = Math.round(p4 * a7)), c6 = new Uint8Array(4 * f2 * h4);
      const r9 = new Uint8ClampedArray(c6.buffer);
      a(s5, e5, t6, r9, f2, h4, false);
    }
    return { size: [f2, h4], image: new Uint32Array(c6.buffer), sdf: false, simplePattern: false, anchorX: 0, anchorY: 0 };
  }
};

// node_modules/@arcgis/core/symbols/cim/CIMSymbolRasterizer.js
var M2;
!function(e5) {
  e5.Legend = "legend", e5.Preview = "preview";
}(M2 || (M2 = {}));
var _2 = (e5) => e5 && e5.scaleFactor ? e5.scaleFactor : 1;
var b2 = 96 / 72;
var z2 = class {
  constructor(e5, t6) {
    this._spatialReference = e5, this._avoidSDF = t6, this._resourceCache = /* @__PURE__ */ new Map(), this._imageDataCanvas = null, this._pictureMarkerCache = /* @__PURE__ */ new Map(), this._textRasterizer = new r(), this._cimResourceManager = new h3(), this._rasterizer = new c5(this._cimResourceManager);
  }
  get resourceManager() {
    return this._cimResourceManager;
  }
  async rasterizeCIMSymbolAsync(e5, t6, a6, i4, r8, o4, s5, n6) {
    if (!e5)
      return null;
    const { data: g2 } = e5;
    if (!g2 || "CIMSymbolReference" !== g2.type || !g2.symbol)
      return null;
    const { symbol: u5 } = g2;
    o4 || (o4 = O(u5));
    const d3 = await ne.resolveSymbolOverrides(g2, t6, this._spatialReference, r8, o4, s5, n6);
    this._imageDataCanvas || (this._imageDataCanvas = document.createElement("canvas"));
    const y2 = this._imageDataCanvas, p4 = this._cimResourceManager, w2 = [];
    ie.fetchResources(d3, p4, w2), ie.fetchFonts(d3, p4, w2), w2.length > 0 && await Promise.all(w2);
    const { width: C2, height: M3 } = a6, _3 = v2(o4, C2, M3, i4), z3 = ie.getEnvelope(d3, _3, p4);
    if (!z3)
      return null;
    const I3 = (window.devicePixelRatio || 1) * b2;
    let x2 = 1, R = 0, P = 0;
    switch (u5.type) {
      case "CIMPointSymbol":
      case "CIMTextSymbol":
        {
          let e6 = 1;
          z3.width > C2 && (e6 = C2 / z3.width);
          let t7 = 1;
          z3.height > M3 && (t7 = M3 / z3.height), "preview" === i4 && (z3.width < C2 && (e6 = C2 / z3.width), z3.height < M3 && (t7 = M3 / z3.height)), x2 = Math.min(e6, t7), R = z3.x + z3.width / 2, P = z3.y + z3.height / 2;
        }
        break;
      case "CIMLineSymbol":
        {
          let e6 = 1;
          z3.height > M3 && (e6 = M3 / z3.height), x2 = e6, P = z3.y + z3.height / 2;
          const t7 = z3.x * x2 + C2 / 2, a7 = (z3.x + z3.width) * x2 + C2 / 2;
          if (t7 < 0) {
            const { paths: e7 } = _3;
            e7[0][0][0] -= t7;
          }
          if (a7 > C2) {
            const { paths: e7 } = _3;
            e7[0][2][0] -= a7 - C2;
          }
        }
        break;
      case "CIMPolygonSymbol": {
        R = z3.x + z3.width / 2, P = z3.y + z3.height / 2;
        const e6 = z3.x * x2 + C2 / 2, t7 = (z3.x + z3.width) * x2 + C2 / 2, a7 = z3.y * x2 + M3 / 2, i5 = (z3.y + z3.height) * x2 + M3 / 2, { rings: r9 } = _3;
        e6 < 0 && (r9[0][0][0] -= e6, r9[0][3][0] -= e6, r9[0][4][0] -= e6), a7 < 0 && (r9[0][0][1] += a7, r9[0][1][1] += a7, r9[0][4][1] += a7), t7 > C2 && (r9[0][1][0] -= t7 - C2, r9[0][2][0] -= t7 - C2), i5 > M3 && (r9[0][2][1] += i5 - M3, r9[0][3][1] += i5 - M3);
      }
    }
    y2.width = C2 * I3, y2.height = M3 * I3;
    const D = 1;
    y2.width += 2 * D, y2.height += 2 * D;
    const S2 = y2.getContext("2d"), k2 = Q.createIdentity();
    k2.translate(-R, -P), k2.scale(x2 * I3, -x2 * I3), k2.translate(C2 * I3 / 2 + D, M3 * I3 / 2 + D), S2.clearRect(0, 0, y2.width, y2.height);
    return new et(S2, p4, k2, true).drawSymbol(d3, _3), S2.getImageData(0, 0, y2.width, y2.height);
  }
  async analyzeCIMSymbol3D(e5, t6, a6, r8, s5) {
    const n6 = [], c6 = t6 ? { geometryType: r8, spatialReference: this._spatialReference, fields: t6 } : null, l5 = [];
    ie.fetchFonts(e5.data.symbol, this._cimResourceManager, l5), await Promise.all(l5);
    const h4 = new G(this._cimResourceManager, c6);
    let g2;
    await h4.analyzeSymbolReference(e5.data, this._avoidSDF, n6), s2(s5);
    for (const i4 of n6)
      "CIMPictureMarker" !== i4.cim.type && "CIMPictureFill" !== i4.cim.type && "CIMPictureStroke" !== i4.cim.type || (g2 || (g2 = []), g2.push(this._fetchPictureMarkerResource(i4, s5))), a6 && "text" === i4.type && "string" == typeof i4.text && i4.text.includes("[") && (i4.text = c3(a6, i4.text, i4.cim.textCase));
    return g2 && await Promise.all(g2), n6;
  }
  rasterizeCIMSymbol3D(e5, t6, a6, i4, r8, o4) {
    const s5 = [];
    for (const n6 of e5) {
      i4 && "function" == typeof i4.scaleFactor && (i4.scaleFactor = i4.scaleFactor(t6, r8, o4));
      const e6 = this._getRasterizedResource(n6, t6, a6, i4, r8, o4);
      if (!e6)
        continue;
      let c6 = 0, l5 = e6.anchorX || 0, h4 = e6.anchorY || 0, m3 = false, g2 = 0, u5 = 0;
      if ("esriGeometryPoint" === a6) {
        const e7 = _2(i4);
        if (g2 = t4(n6.offsetX, t6, r8, o4) * e7 || 0, u5 = t4(n6.offsetY, t6, r8, o4) * e7 || 0, "marker" === n6.type)
          c6 = t4(n6.rotation, t6, r8, o4) || 0, m3 = n6.rotateClockwise ?? false;
        else if ("text" === n6.type) {
          if (c6 = t4(n6.angle, t6, r8, o4) || 0, void 0 !== n6.horizontalAlignment)
            switch (n6.horizontalAlignment) {
              case "left":
                l5 = -0.5;
                break;
              case "right":
                l5 = 0.5;
                break;
              default:
                l5 = 0;
            }
          if (void 0 !== n6.verticalAlignment)
            switch (n6.verticalAlignment) {
              case "top":
                h4 = 0.5;
                break;
              case "bottom":
                h4 = -0.5;
                break;
              case "baseline":
                h4 = -0.25;
                break;
              default:
                h4 = 0;
            }
        }
      }
      null != e6 && s5.push({ angle: c6, rotateClockWise: m3, anchorX: l5, anchorY: h4, offsetX: g2, offsetY: u5, rasterizedResource: e6 });
    }
    return this.getSymbolImage(s5);
  }
  getSymbolImage(e5) {
    const t6 = document.createElement("canvas"), i4 = u(t6.getContext("2d"));
    let o4 = 0, s5 = 0, n6 = 0, c6 = 0;
    const l5 = [];
    for (let a6 = 0; a6 < e5.length; a6++) {
      const t7 = e5[a6], h5 = t7.rasterizedResource;
      if (!h5)
        continue;
      const m4 = h5.size, g3 = t7.offsetX, u5 = t7.offsetY, f2 = t7.anchorX, d3 = t7.anchorY, y2 = t7.rotateClockWise || false;
      let p4 = t7.angle, w2 = u2(g3) - m4[0] * (0.5 + f2), C2 = u2(u5) - m4[1] * (0.5 + d3), M3 = w2 + m4[0], _3 = C2 + m4[1];
      if (p4) {
        y2 && (p4 = -p4);
        const e6 = Math.sin(p4 * Math.PI / 180), t8 = Math.cos(p4 * Math.PI / 180), a7 = w2 * t8 - C2 * e6, i5 = w2 * e6 + C2 * t8, r8 = w2 * t8 - _3 * e6, o5 = w2 * e6 + _3 * t8, s6 = M3 * t8 - _3 * e6, n7 = M3 * e6 + _3 * t8, c7 = M3 * t8 - C2 * e6, l6 = M3 * e6 + C2 * t8;
        w2 = Math.min(a7, r8, s6, c7), C2 = Math.min(i5, o5, n7, l6), M3 = Math.max(a7, r8, s6, c7), _3 = Math.max(i5, o5, n7, l6);
      }
      o4 = w2 < o4 ? w2 : o4, s5 = C2 < s5 ? C2 : s5, n6 = M3 > n6 ? M3 : n6, c6 = _3 > c6 ? _3 : c6;
      const b3 = i4.createImageData(h5.size[0], h5.size[1]);
      b3.data.set(new Uint8ClampedArray(h5.image.buffer));
      const z3 = { offsetX: g3, offsetY: u5, rotateClockwise: y2, angle: p4, rasterizedImage: b3, anchorX: f2, anchorY: d3 };
      l5.push(z3);
    }
    t6.width = n6 - o4, t6.height = c6 - s5;
    const h4 = -o4, m3 = c6;
    for (let a6 = 0; a6 < l5.length; a6++) {
      const e6 = l5[a6], t7 = this._imageDataToCanvas(e6.rasterizedImage), o5 = e6.rasterizedImage.width, s6 = e6.rasterizedImage.height, n7 = h4 - o5 * (0.5 + e6.anchorX), c7 = m3 - s6 * (0.5 - e6.anchorY);
      if (e6.angle) {
        const a7 = (360 - e6.angle) * Math.PI / 180;
        i4.save(), i4.translate(u2(e6.offsetX), -u2(e6.offsetY)), i4.translate(h4, m3), i4.rotate(a7), i4.translate(-h4, -m3), i4.drawImage(t7, n7, c7), i4.restore();
      } else
        i4.drawImage(t7, n7 + u2(e6.offsetX), c7 - u2(e6.offsetY));
    }
    const g2 = new p({ x: h4 / t6.width - 0.5, y: m3 / t6.height - 0.5 });
    return { imageData: 0 !== t6.width && 0 !== t6.height ? i4.getImageData(0, 0, t6.width, t6.height) : i4.createImageData(1, 1), anchorPosition: g2 };
  }
  async _fetchPictureMarkerResource(e5, a6) {
    const i4 = e5.materialHash;
    if (!this._pictureMarkerCache.get(i4)) {
      const r8 = (await j(e5.cim.url, { responseType: "image", signal: a6 && a6.signal })).data;
      this._pictureMarkerCache.set(i4, r8);
    }
  }
  _imageDataToCanvas(e5) {
    this._imageDataCanvas || (this._imageDataCanvas = document.createElement("canvas"));
    const t6 = this._imageDataCanvas, i4 = u(t6.getContext("2d"));
    return t6.width = e5.width, t6.height = e5.height, i4.putImageData(e5, 0, 0), t6;
  }
  _imageTo32Array(t6, i4, r8, o4) {
    this._imageDataCanvas || (this._imageDataCanvas = document.createElement("canvas"));
    const s5 = this._imageDataCanvas, n6 = u(s5.getContext("2d"));
    if (s5.width = i4, s5.height = r8, n6.drawImage(t6, 0, 0, i4, r8), o4) {
      n6.save();
      const a6 = new h(o4);
      n6.fillStyle = a6.toHex(), n6.globalCompositeOperation = "multiply", n6.fillRect(0, 0, i4, r8), n6.globalCompositeOperation = "destination-atop", n6.drawImage(t6, 0, 0, i4, r8), n6.restore();
    }
    return new Uint32Array(n6.getImageData(0, 0, i4, r8).data.buffer);
  }
  _getRasterizedResource(e5, t6, i4, r8, o4, s5) {
    let n6, c6, l5;
    const h4 = null, m3 = null;
    if ("text" === e5.type)
      return this._rasterizeTextResource(e5, t6, r8, o4, s5);
    ({ analyzedCIM: n6, hash: c6 } = I2(e5, t6, o4, s5));
    const g2 = _2(r8);
    if ("CIMPictureMarker" === e5.cim.type) {
      const i5 = t4(e5.size, t6, o4, s5) * g2, { image: r9, width: n7, height: c7 } = u(this._getPictureResource(e5, i5, t4(e5.color, t6, o4, s5)));
      return l5 = { image: r9, size: [n7, c7], sdf: false, simplePattern: false, anchorX: e5.anchorPoint ? e5.anchorPoint.x : 0, anchorY: e5.anchorPoint ? e5.anchorPoint.y : 0 }, l5;
    }
    m(n6, g2, { preserveOutlineWidth: false });
    const u5 = n6;
    c6 += i4, r8 && (c6 += JSON.stringify(r8));
    const f2 = this._resourceCache;
    return f2.has(c6) ? f2.get(c6) : (l5 = this._rasterizer.rasterizeJSONResource({ cim: u5, type: e5.type, url: e5.url, mosaicHash: c6, size: h4, path: m3 }, window.devicePixelRatio || 1, this._avoidSDF), f2.set(c6, l5), l5);
  }
  _rasterizeTextResource(e5, t6, a6, i4, r8) {
    var _a, _b, _c;
    const o4 = _2(a6), s5 = t4(e5.text, t6, i4, r8);
    if (!s5 || 0 === s5.length)
      return null;
    const n6 = e5.cim, c6 = t4((n6 == null ? void 0 : n6.fontFamilyName) || e5.fontName, t6, i4, r8), l5 = t4(((_a = n6 == null ? void 0 : n6.font) == null ? void 0 : _a.style) || e5.style, t6, i4, r8), h4 = t4(((_b = n6 == null ? void 0 : n6.font) == null ? void 0 : _b.weight) || e5.weight, t6, i4, r8), m3 = t4(((_c = n6 == null ? void 0 : n6.font) == null ? void 0 : _c.decoration) || e5.decoration, t6, i4, r8), g2 = t4(e5.size, t6, i4, r8) * o4, u5 = t4(e5.horizontalAlignment, t6, i4, r8), f2 = t4(e5.verticalAlignment, t6, i4, r8), d3 = r2(t4(e5.color, t6, i4, r8)), w2 = r2(t4(e5.outlineColor, t6, i4, r8)), C2 = t4(e5.outlineSize, t6, i4, r8), M3 = null != e5.backgroundColor ? r2(e5.backgroundColor) : null, b3 = null != e5.borderLineColor ? r2(e5.borderLineColor) : null, z3 = null != e5.borderLineWidth ? e5.borderLineWidth : null, v3 = { color: d3, size: g2, horizontalAlignment: u5, verticalAlignment: f2, font: { family: c6, style: l5, weight: h4, decoration: m3 }, halo: { size: C2 || 0, color: w2, style: l5 }, backgroundColor: M3, borderLine: null != b3 && null != z3 ? { color: b3, size: z3 } : null, pixelRatio: 1, premultiplyColors: !this._avoidSDF };
    return this._textRasterizer.rasterizeText(s5, v3);
  }
  _getPictureResource(e5, t6, a6) {
    const i4 = this._pictureMarkerCache.get(e5.materialHash);
    if (!i4)
      return null;
    const o4 = i4.height / i4.width, s5 = t6 ? o4 > 1 ? u2(t6) : u2(t6) / o4 : i4.width, n6 = t6 ? o4 > 1 ? u2(t6) * o4 : u2(t6) : i4.height;
    return { image: this._imageTo32Array(i4, s5, n6, a6), width: s5, height: n6 };
  }
};
function v2(e5, t6, a6, i4) {
  const r8 = 1, o4 = -t6 / 2 + r8, s5 = t6 / 2 - r8, n6 = a6 / 2 - r8, c6 = -a6 / 2 + r8;
  switch (e5) {
    case "esriGeometryPoint":
      return { x: 0, y: 0 };
    case "esriGeometryPolyline":
      return { paths: [[[o4, 0], [0, 0], [s5, 0]]] };
    default:
      return "legend" === i4 ? { rings: [[[o4, n6], [s5, 0], [s5, c6], [o4, c6], [o4, n6]]] } : { rings: [[[o4, n6], [s5, n6], [s5, c6], [o4, c6], [o4, n6]]] };
  }
}
function I2(e5, t6, a6, i4) {
  let r8, o4;
  if ("function" == typeof e5.materialHash) {
    r8 = (0, e5.materialHash)(t6, a6, i4), o4 = V(e5.cim, e5.materialOverrides);
  } else
    r8 = e5.materialHash, o4 = e5.cim;
  return { analyzedCIM: o4, hash: r8 };
}

export {
  M2 as M,
  z2 as z
};
//# sourceMappingURL=chunk-ZOHEEWVR.js.map
